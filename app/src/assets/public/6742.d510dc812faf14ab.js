"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6742],{3632:(O,T,r)=>{r.d(T,{U:()=>C});var M=r(467),y=r(7328),t=r(6996),o=r(8974),p=r(7157),b=r(9884),F=r(177),S=r(9417),A=r(9664);function e(f,E){if(1&f&&(t.j41(0,"ion-select-option",15),t.EFF(1),t.k0s()),2&f){const i=E.$implicit;t.FS9("value",i.value),t.R7$(1),t.JRh(i.name)}}function L(f,E){if(1&f){const i=t.RV6();t.j41(0,"section")(1,"ion-item")(2,"ion-label",8),t.EFF(3,"Antenna Radious (m)"),t.k0s(),t.j41(4,"ion-input",9),t.bIt("ngModelChange",function(_){t.eBV(i);const u=t.XpG();return t.Njj(u.ant_radius=_)}),t.k0s()(),t.j41(5,"ion-item")(6,"ion-label",8),t.EFF(7,"Antenna L1 Height (m)"),t.k0s(),t.j41(8,"ion-input",9),t.bIt("ngModelChange",function(_){t.eBV(i);const u=t.XpG();return t.Njj(u.ant_l1_height=_)}),t.k0s()(),t.j41(9,"ion-item")(10,"ion-label",8),t.EFF(11,"Antenna L2 Height (m)"),t.k0s(),t.j41(12,"ion-input",9),t.bIt("ngModelChange",function(_){t.eBV(i);const u=t.XpG();return t.Njj(u.ant_l2_height=_)}),t.k0s()(),t.j41(13,"ion-item")(14,"ion-label",8),t.EFF(15,"Antenna ARP (m)"),t.k0s(),t.j41(16,"ion-input",9),t.bIt("ngModelChange",function(_){t.eBV(i);const u=t.XpG();return t.Njj(u.ant_arp_height=_)}),t.k0s()()()}if(2&f){const i=t.XpG();t.R7$(4),t.Y8G("ngModel",i.ant_radius),t.R7$(4),t.Y8G("ngModel",i.ant_l1_height),t.R7$(4),t.Y8G("ngModel",i.ant_l2_height),t.R7$(4),t.Y8G("ngModel",i.ant_arp_height)}}let C=(()=>{class f{constructor(i,g,_){this.modalController=i,this.navParams=g,this.dataService=_,this.use_slant_height=!1,this.ant_user_height=0,this.ant_radius=.073,this.ant_l1_height=.05,this.ant_l2_height=.05,this.ant_arp_height=.04,this.ant_calculated_height=0,this.ant_measure_type="pole",this.ant_measure_type_list=[{name:"Pole Height",value:"pole"},{name:"Phase Center",value:"phase center"},{name:"Slant Height",value:"slant"}],this.ant_type=[{name:"GN-GG0710",value:{radious:.07575,l1:.048,l2:.044,arp:.036}},{name:"GPS500",value:{radious:.076,l1:.054,l2:.0478,arp:.03}},{name:"PRB2",value:{radious:.0675,l1:.087,l2:.0824,arp:.078}},{name:"PRB3",value:{radious:.0675,l1:.087,l2:.0824,arp:.078}}],this.show_detail=!1}ngOnInit(){this.ant_user_height=this.navParams.get("ant_height"),this.ant_measure_type=this.navParams.get("measure_type"),"variscite"===this.dataService.info.platform?this.ant_model=typeof this.dataService.info.ant_model>"u"?"GN-GG0710":this.dataService.info.ant_model:this.dataService.isPRB2?this.ant_model=typeof this.dataService.info.ant_model>"u"?"PRB2":this.dataService.info.ant_model:this.dataService.isPRB3&&(this.ant_model=typeof this.dataService.info.ant_model>"u"?"PRB3":this.dataService.info.ant_model);let i=this.getAntInfo(this.ant_model);this.ant_radius=i.value.radious,this.ant_l1_height=i.value.l1,this.ant_l2_height=i.value.l2,this.ant_arp_height=i.value.arp}confirm_modal(){var i=this;return(0,M.A)(function*(){let g=(i.ant_l1_height+i.ant_l2_height)/2,_=g-i.ant_arp_height;switch(console.log("height_edge_phase_center",_),i.ant_measure_type){case"pole":i.ant_calculated_height=i.ant_user_height+g;break;case"phase center":i.ant_calculated_height=i.ant_user_height+_;break;case"slant":i.ant_calculated_height=Math.sqrt(i.ant_user_height**2-i.ant_radius**2)+_}i.ant_calculated_height=y.LIG(i.ant_calculated_height,4),console.log("Calculated Antenna Height",i.ant_calculated_height),yield i.modalController.dismiss(i.ant_measure_type,`${i.ant_calculated_height}`)})()}cancel_modal(){var i=this;return(0,M.A)(function*(){yield i.modalController.dismiss("cancel")})()}getAntInfo(i){return this.ant_type.find(_=>_.name==i)}showDetail(){this.show_detail=!this.show_detail}static{this.\u0275fac=function(g){return new(g||f)(t.rXU(o.W3),t.rXU(p.y8),t.rXU(b.f))}}static{this.\u0275cmp=t.VBU({type:f,selectors:[["app-modal-antenna"]],decls:35,vars:22,consts:[[1,"custom-header"],["color","darkblue",1,"ion-align-items-center","custom-toolbar"],["slot","end",1,"center-vertical",3,"click"],["slot","icon-only","name","close"],[3,"fullscreen"],[1,"mt-3"],["label","Antenna Measure Type",3,"ngModel","okText","cancelText","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["position","floating"],["aria-label","","type","number",3,"ngModel","ngModelChange"],[3,"click"],[4,"ngIf"],[3,"translucent"],["expand","full","color","medium",3,"click"],["expand","full","color","success",3,"click"],[3,"value"]],template:function(g,_){1&g&&(t.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t.EFF(3,"Antenna Height"),t.k0s(),t.j41(4,"ion-buttons",2),t.bIt("click",function(){return _.cancel_modal()}),t.nrm(5,"ion-icon",3),t.k0s()()(),t.j41(6,"ion-content",4)(7,"ion-list")(8,"ion-item",5)(9,"ion-select",6),t.bIt("ngModelChange",function(P){return _.ant_measure_type=P}),t.nI1(10,"translate"),t.nI1(11,"translate"),t.DNE(12,e,2,2,"ion-select-option",7),t.k0s()(),t.j41(13,"ion-item")(14,"ion-label",8),t.EFF(15),t.nI1(16,"translate"),t.k0s(),t.j41(17,"ion-input",9),t.bIt("ngModelChange",function(P){return _.ant_user_height=P}),t.k0s()(),t.j41(18,"ion-item")(19,"ion-label",10),t.bIt("click",function(){return _.showDetail()}),t.EFF(20),t.k0s()(),t.DNE(21,L,17,4,"section",11),t.k0s()(),t.j41(22,"ion-footer",12)(23,"ion-grid")(24,"ion-row")(25,"ion-col")(26,"div")(27,"ion-button",13),t.bIt("click",function(){return _.cancel_modal()}),t.EFF(28),t.nI1(29,"translate"),t.k0s()()(),t.j41(30,"ion-col")(31,"div")(32,"ion-button",14),t.bIt("click",function(){return _.confirm_modal()}),t.EFF(33),t.nI1(34,"translate"),t.k0s()()()()()()),2&g&&(t.R7$(6),t.Y8G("fullscreen",!0),t.R7$(3),t.FS9("okText",t.bMT(10,12,"OK")),t.FS9("cancelText",t.bMT(11,14,"CANCEL")),t.Y8G("ngModel",_.ant_measure_type),t.R7$(3),t.Y8G("ngForOf",_.ant_measure_type_list),t.R7$(3),t.SpI("",t.bMT(16,16,"ANT_HEIGHT")," (m)"),t.R7$(2),t.Y8G("ngModel",_.ant_user_height),t.R7$(3),t.SpI(" Antenna Model ",_.ant_model," "),t.R7$(1),t.Y8G("ngIf",_.show_detail),t.R7$(1),t.Y8G("translucent",!0),t.R7$(6),t.JRh(t.bMT(29,18,"CANCEL")),t.R7$(5),t.JRh(t.bMT(34,20,"CONFIRM")))},dependencies:[F.Sq,F.bT,S.BC,S.vS,o.Jm,o.QW,o.hU,o.W9,o.M0,o.lO,o.eU,o.iq,o.$w,o.uz,o.he,o.nf,o.ln,o.Nm,o.Ip,o.BC,o.ai,o.su,o.Je,A.D9],styles:['@charset "UTF-8";.custom-header[_ngcontent-%COMP%]{position:relative;max-height:52px;height:52px}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%);width:100%;display:flex;align-items:center;justify-content:space-between}']})}}return f})()},6742:(O,T,r)=>{r.r(T),r.d(T,{HttpLoaderFactory:()=>x,SettingLogPageModule:()=>B});var M=r(177),y=r(9417),t=r(1470),o=r(8974),p=r(467),b=r(2739),F=r(2233),S=r(3632),A=r(7247),e=r(6996),L=r(9884),C=r(7157),f=r(252),E=r(1626),i=r(9664);function g(c,j){if(1&c&&(e.j41(0,"ion-select-option",19),e.EFF(1),e.k0s()),2&c){const n=j.$implicit;e.FS9("value",n.value),e.R7$(1),e.JRh(n.name)}}function _(c,j){if(1&c){const n=e.RV6();e.j41(0,"ion-row")(1,"ion-col")(2,"ion-item")(3,"ion-label",13),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"ion-input",15),e.bIt("ngModelChange",function(l){e.eBV(n);const s=e.XpG(2);return e.Njj(s.ant_height=l)}),e.k0s(),e.j41(7,"ion-button",16),e.bIt("click",function(){e.eBV(n);const l=e.XpG(2);return e.Njj(l.set_ant_height())}),e.EFF(8,"..."),e.k0s()(),e.j41(9,"ion-item")(10,"ion-select",17),e.bIt("ngModelChange",function(l){e.eBV(n);const s=e.XpG(2);return e.Njj(s.rinex=l)}),e.nI1(11,"translate"),e.nI1(12,"translate"),e.DNE(13,g,2,2,"ion-select-option",18),e.k0s()(),e.j41(14,"ion-item")(15,"ion-button",14),e.bIt("click",function(){e.eBV(n);const l=e.XpG(2);return e.Njj(l.rinexButton())}),e.EFF(16),e.nI1(17,"translate"),e.k0s()()()()}if(2&c){const n=e.XpG(2);e.R7$(4),e.SpI("",e.bMT(5,7,"ANT_HEIGHT")," (m)"),e.R7$(2),e.Y8G("ngModel",n.ant_height),e.R7$(4),e.FS9("okText",e.bMT(11,9,"OK")),e.FS9("cancelText",e.bMT(12,11,"CANCEL")),e.Y8G("ngModel",n.rinex),e.R7$(3),e.Y8G("ngForOf",n.rinex_list),e.R7$(3),e.SpI(" ",e.bMT(17,13,"LB_RINEX_CONVERT")," ")}}function u(c,j){if(1&c){const n=e.RV6();e.j41(0,"section")(1,"ion-grid")(2,"ion-row")(3,"ion-col")(4,"ion-label",13),e.EFF(5),e.k0s()()(),e.j41(6,"ion-row")(7,"ion-col")(8,"ion-item")(9,"ion-button",14),e.bIt("click",function(){e.eBV(n);const l=e.XpG();return e.Njj(l.dowloadButton())}),e.EFF(10),e.nI1(11,"translate"),e.k0s()()()(),e.DNE(12,_,18,15,"ion-row",12),e.k0s()()}if(2&c){const n=e.XpG();e.R7$(5),e.JRh(n.file_name),e.R7$(5),e.SpI(" ",e.bMT(11,3,"LB_DOWNLOAD")," "),e.R7$(2),e.Y8G("ngIf",n.rinex_supported)}}var I=`${b.__.Cache}`;const k="/log";let D=(()=>{class c{constructor(n,a,l,s,m,d,h,v){this.dataService=n,this.nav=a,this.platform=l,this.file=s,this.alertController=m,this.http=d,this.modalController=h,this.translate=v,this.get_ip="",this.connected=!1,this.remote_file=!0,this.wifi_mode=!0,this.ant_measure_type="slant",this.ant_height=0,this.rinex="3.02",this.rinex_list=[{name:"3.01",value:"3.01"},{name:"3.02",value:"3.02"},{name:"3.03",value:"3.03"},{name:"3.04",value:"3.04"}],this.file_name="",this.message_wait="",this.message_not_ubx="",this.message_log_use_wifi="",this.rinex_supported=!1,this.translate.setDefaultLang("en")}ngOnInit(){this.translate.get("MSG_PLEASE_FEW_MINUITS").subscribe(n=>{this.message_wait=n}),this.translate.get("MSG_NOT_UBX_FILE").subscribe(n=>{this.message_not_ubx=n}),this.translate.get("MSG_LOG_USE_WIFI").subscribe(n=>{this.message_log_use_wifi=n}),this.platform.is("ios"),I=this.file.cacheDirectory,console.log("Log Tab"),this.connected=this.dataService.connected,this.connected&&(this.get_ip=this.dataService.ip,this.getFileList(),this.wifi_mode=this.dataService.wifi_connected,this.rinex_supported=this.dataService.isRINEXSupported,this.ant_height=this.dataService.config.rover.antenna_height,this.wifi_mode||this.alertDialog(this.message_log_use_wifi))}getFileList(){this.remote_file?this.dataService.wifi_connected?this.dataService.getFilelist().then(n=>{this.drawFileList(n)},n=>{}):$("#file_sol").empty():this.getLocalFileList()}getLocalFileList(){b.YA.readdir({path:"/log",directory:b.__.Cache}).then(n=>{let l=[];n.files.forEach(s=>{"file"==s.type&&l.push({name:s.name,size:this.convertDataSize(s.size),data:this.convertTimetoISO(s.ctime)})}),this.drawFileList({files:l})},n=>{console.log(n)})}convertTimetoISO(n){if(typeof n>"u")return"";let a=new Date;return a.setTime(n),a.toISOString()}convertDataSize(n){return n/1e6<1?`${(n/1e3).toFixed(2)} KB`:`${(n/1e6).toFixed(2)} MB`}dowloadButton(){let n=`http://${this.get_ip}:3000/file_download?name=`+this.file_name;""!==this.file_name&&(this.progress_load="indeterminate",this.remote_file?this.downLoad(n,I,this.file_name):this.downloadLocal(I,this.file_name))}downLoad(n,a,l){var s=this;this.dataService.bluetoothMode||this.http.get(n,{responseType:"blob",observe:"body"}).subscribe(function(){var m=(0,p.A)(function*(d){if(s.platform.is("mobileweb"))return console.log("No supported for this platform download"),void(s.progress_load="determinate");if(-1==l.indexOf(".zip"))try{let h=l+".zip";h=h.replace(".","-");let v=new A;v.file(l,d.arrayBuffer()),v.generateAsync({type:"blob"}).then(R=>{s.file.writeFile(a,h,R,{replace:!0}).then((0,p.A)(function*(){yield F.S.share({title:"Share",url:a+h})}))})}catch(h){console.log(h)}finally{s.progress_load="determinate"}else try{s.file.writeFile(a,l,d,{replace:!0}).then((0,p.A)(function*(){yield F.S.share({title:"Share",url:a+l})}))}catch(h){console.log(h)}finally{s.progress_load="determinate"}});return function(d){return m.apply(this,arguments)}}())}downloadLocal(n,a){let l=k+"/"+a;try{F.S.share({title:"Share",url:I+l}).then(s=>{},s=>{console.log(s)})}catch(s){console.log(s)}finally{this.progress_load="determinate"}}rinexButton(){if(-1===this.file_name.indexOf(".ubx"))return void this.alertDialog(this.message_not_ubx);this.alertDialog(this.message_wait);let n=this.file_name.substring(0,this.file_name.indexOf("_"));this.convertRINEX(n,this.ant_height,this.rinex)}convertRINEX(n,a,l){this.http.get(`http://${this.get_ip}:3000/rinex?file_name=${n}&ant_height=${a}&rinex_version=${l}`,{responseType:"json",observe:"body"}).subscribe(function(){var m=(0,p.A)(function*(d){});return function(d){return m.apply(this,arguments)}}())}str2ab(n){for(var a=new ArrayBuffer(n.length),l=new Uint8Array(a),s=0,m=n.length;s<m;s++)l[s]=n.charCodeAt(s);return a}deleteFile(n){b.YA.deleteFile({path:k+"/"+n,directory:b.__.Cache}),this.file_name=""}drawFileList(n){let a=this;$("#file_sol").empty();let l=n.files;l.sort((d,h)=>{let v=new Date(d.date),R=new Date(h.date);return v<R?1:v>R?-1:0});let s="";for(let d in l){s=`${l[d].name}`;var m=`<tr>\n        <td class="mt-2 f_n download_f" id="${s}">${s}</td>\n        <td mt-2>${l[d].size}</td>\n        <td><i class="fas fa-trash-alt fa-lg delfile" id="delfile_${l[d].name}"></i></td>\n        </tr>`;$("#file_sol").append(m)}$(".download_f").on("click",(0,p.A)(function*(){let d=$(this).attr("id");a.file_name=d})),$(".delfile").on("click",(0,p.A)(function*(){yield(yield a.alertController.create({header:"Confirm!",message:"Delete this log ?",buttons:[{text:"Cancel",role:"cancel",handler:()=>{}},{text:"OK",handler:()=>{let h=$(this).attr("id");h=h.substring(h.indexOf("_")+1,h.length),a.remote_file?(a.dataService.getDeletefile(h).then(v=>{}),a.file_name=""):(a.deleteFile(h),a.file_name=""),$(this).parent().parent().remove()}}]})).present()}))}refresh(n){$("#icon_refresh").css("transition","all 1s"),$("#icon_refresh").css("transform","rotate(360deg)"),setTimeout(()=>{$("#icon_refresh").css("transition","all 0s"),$("#icon_refresh").css("transform","rotate(0deg)")},1e3),this.getFileList()}alertDialog(n){var a=this;return(0,p.A)(function*(){yield(yield a.alertController.create({header:"Alert!",message:n,buttons:[{text:"OK",handler:()=>{}}]})).present()})()}remoteFileSelected(){this.getFileList()}set_ant_height(){var n=this;return(0,p.A)(function*(){const a=yield n.modalController.create({component:S.U,cssClass:"modal-css-70",componentProps:{ant_height:n.ant_height,measure_type:n.ant_measure_type}});return a.onDidDismiss().then(l=>{if(null!==l){let s=l.role;if(typeof s>"u"||"cancel"===l.data||"backdrop"===s)return;n.ant_measure_type=l.data,n.ant_height=Number(s),n.dataService.config.base.ant_offset_u=n.ant_height}}),yield a.present()})()}static{this.\u0275fac=function(a){return new(a||c)(e.rXU(L.f),e.rXU(C.q9),e.rXU(C.OD),e.rXU(f.Z),e.rXU(o.hG),e.rXU(E.Qq),e.rXU(o.W3),e.rXU(i.c$))}}static{this.\u0275cmp=e.VBU({type:c,selectors:[["app-setting-log"]],decls:29,vars:15,consts:[["color","darkblue"],["slot","start"],["defaultHref","/tabs/tab5"],["slot","end",3,"click"],["id","icon_refresh","slot","icon-only","name","refresh"],[3,"type"],[3,"fullscreen"],[1,"form-group","text-center"],[1,"table","table-hover"],[1,"table-dark","f_size-12"],[1,"text-white"],["id","file_sol",1,"table-primary","f_size-10"],[4,"ngIf"],["position","stacked"],["expand","block","color","warning",1,"export",3,"click"],["aria-label","","placeholder","1.8","type","number",3,"ngModel","ngModelChange"],["id","ant_bttn","slot","end",3,"click"],["label","RINEX version",3,"ngModel","okText","cancelText","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(a,l){1&a&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"ion-buttons",3),e.bIt("click",function(m){return l.refresh(m)}),e.j41(8,"ion-button"),e.nrm(9,"ion-icon",4),e.k0s()()(),e.nrm(10,"ion-progress-bar",5),e.k0s(),e.j41(11,"ion-content",6)(12,"div",7)(13,"table",8)(14,"thead",9)(15,"tr",10)(16,"th"),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"th"),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"th"),e.EFF(23),e.nI1(24,"translate"),e.k0s()()(),e.nrm(25,"tbody",11),e.k0s()()(),e.j41(26,"ion-footer")(27,"ion-toolbar"),e.DNE(28,u,13,5,"section",12),e.k0s()()),2&a&&(e.R7$(5),e.JRh(e.bMT(6,7,"LOG")),e.R7$(5),e.Y8G("type",l.progress_load),e.R7$(1),e.Y8G("fullscreen",!0),e.R7$(6),e.JRh(e.bMT(18,9,"FILE_NAME")),e.R7$(3),e.JRh(e.bMT(21,11,"FILE_SIZE")),e.R7$(3),e.JRh(e.bMT(24,13,"FILE_DELETE")),e.R7$(5),e.Y8G("ngIf",l.remote_file&&l.wifi_mode))},dependencies:[M.Sq,M.bT,y.BC,y.vS,o.Jm,o.QW,o.hU,o.W9,o.M0,o.lO,o.eU,o.iq,o.$w,o.uz,o.he,o.FH,o.ln,o.Nm,o.Ip,o.BC,o.ai,o.su,o.Je,o.el,i.D9],styles:[".f_size-12[_ngcontent-%COMP%]{font-size:12px}.f_size-10[_ngcontent-%COMP%]{font-size:10px}.border_gray[_ngcontent-%COMP%]{border-style:solid;border-width:3px;border-color:#696566}"]})}}return c})();var G=r(5635);function x(c){return new G.s(c,"./assets/i18n/",".json")}const w=[{path:"",component:D}];let B=(()=>{class c{static{this.\u0275fac=function(a){return new(a||c)}}static{this.\u0275mod=e.$C({type:c})}static{this.\u0275inj=e.G2t({imports:[M.MD,y.YN,o.bv,t.iI.forChild(w),i.h.forChild({loader:{provide:i.Wr,useFactory:x,deps:[E.Qq]}})]})}}return c})()}}]);